<% provide(:title, @consignment.name) %>
<div class="page-header">
  <div class="row">
    <div class="span10">
      <h2>
        <%= @consignment.name %>
        <small>a <%= @consignment.supplier.name %></small>
      </h2>
    </div>
  </div>
</div>

<p>
  <%= link_to "Editar", edit_consignment_path(@consignment), class: "btn btn-small" %>
  <%= link_to "Borrar", @consignment, class: "btn btn-small btn-danger", method: :delete, data: { confirm: "Esta seguro?" } %>
</p>

<h3>Productos en este pedido</h3>
<%= will_paginate @consignment_details %>

<table class="table table-striped table-bordered table-hover table-condensed">
  <thead>
    <tr>
      <th>Código</th>
      <th>Nombre</th>
      <th>Activo?</th>
      <th>Precio</th>
      <th>Stock</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <%#= render @products %>
  </tbody>
</table>

<%= will_paginate @consignment_details %>

<h3>Agregar productos</h3>

<div class="row">
  <div class="offset8 span4">
    <%= form_tag consignment_path(@consignment), :method => "get", :class => "form-search" do %>
      <%= text_field_tag :search, params[:search], :class => "input-medium search-query" %>
      <%= button_tag "Buscar", :type => "submit", :class => "btn btn-inverse", :name => nil %>
    <% end %>
  </div>
</div>

<% if !@products.nil? %>
<table class="table table-striped table-bordered table-hover table-condensed">
  <thead>
    <tr>
      <th>Código</th>
      <th>Nombre</th>
      <th>Precio</th>
      <th>Stock</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <% @products.each do |product| %>
    <tr>
      <td class="text-center"><%= product.id %></td>
      <td><%= product.short_name %></td>
      <td class="text-right"><%= product.stocks.first.price if product.stocks.any? %></td>
      <td class="text-right"><%= product.stocks.sum(:quantity) %></td>
      <td class="text-center">
        <%= form_for consignment_details_path do |c| %>
        <%= c.hidden_field :consignment_id, :value => @consignment.id %>
        <%= c.hidden_field :product_id, :value => product.id %>
        <%= c.text_field 'quantity', :value => "1", class: "input-mini" %><br />
        <%= submit_tag "Agregar", class: "btn btn-primary" %>
        <% end %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
<% end %>

